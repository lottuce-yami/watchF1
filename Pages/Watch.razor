@page "/Watch"
@using F1Project.Data.Database.Services
@using F1Project.Data.Database.Types
@inject NavigationManager Nav
@inject VideoService VideoServ

<PageTitle>watchF1 - @Video.Title</PageTitle>

<VideoPlayer Source="@Video.File" Preview="@Video.Preview" Title="@Video.Title"/>
<hr>
<section id="other-videos">
    <h2>Другие видео:</h2>
    <br>
    <VideoList List="@OtherVideos.Where(otherVideo => otherVideo.Id != Video.Id)"/>
</section>

@code {
    [Parameter]
    [SupplyParameterFromQuery(Name = "v")]
    public string? Id { get; set; }

    private Video Video { get; set; } = null!;

    private IList<Video> OtherVideos { get; set; } = null!;

    protected override void OnParametersSet()
    {
        if (Id == null)
        {
            Nav.NavigateTo("videos");
        }
        try
        {
            Video = VideoServ.Get(Id ?? "");
            OtherVideos = VideoServ.GetBy("GrandPrix", Video.GrandPrix);
        }
        catch
        {
            Nav.NavigateTo("videos");
        }
    }

    /*protected override void OnInitialized()
    {
        if (!string.IsNullOrWhiteSpace(VideoId)) return;
        Nav.NavigateTo("videos");
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await Js.InvokeVoidAsync("getPlayer", Video.File, Video.Preview);
    }

    private async void DownloadVideo()
    {
        await Js.InvokeVoidAsync("download", Video.File, Video.Title);
    }*/
}